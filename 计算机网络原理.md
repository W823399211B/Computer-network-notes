#            计算机网络原理

## 第一章       计算机网络概述

### 第一节          计算机网络基本概念

一· 计算机网络的定义

​    计算机网络是利用通信设备与通信链路或者通信网络，互连位置不同、功能自治的计算机系统，并遵循一定的规则实现计算机系统之间信息交换。

概括性的定义：计算机网络是互连的、自治的计算机的集合。

二、协议的定义

协议是网络通信实体之间在数据交换过程中需要遵循规则或约定，包括三个基本要素：

1. 语法  格式
2. 语义  内容
3. 时序  顺序

### 第二节        计算机网络结构     

网络边缘    接入网络     网络核心

### 第三节        数据交换

电路交换   报文交换  分组交换

### 第四节       计算机网络性能

一、速率与带宽

- 速率是指网络单位时间内传送的数据量，也称为数据传输速率或数据速率。速率的基本单位是bit/s（位每秒）    bps
- 在计算机网络中，有时也会用“带宽”这一术语描述速率
- 带宽原本是指信号具有的频带宽度，即信号成分的最高频率与最低频率之差，单位位Hz（赫兹）

二、时延

- 结点处理时延
- 排队时延
- 传输时延  搬上传送带
- 传播时延  运输时间

三、时延带宽积

一段物理链路的传播时延与链路带宽的乘积  表示一段链路可以容纳的数据位数，也称为以位为单位的链路长度

四、丢包率

丢失分组/发送分组总数

五、吞吐量

单位时间内源主机通过网络向目的主机实际送达的数据量

### 第五节    计算机网络体系结构

一、计算机网络分层体系结构

1.分层思想：

计算机网络完成的所有功能可以划分为若干层，每层完成一部分子功能，每层在完成相应功能时与另一通信实体的相同层按照某种协议进行信息交换。网卡-操作系统-协议-应用     一层一层加

2.体系结构定义：

计算机网络所划分的层次以及各层协议的集合称为计算机网络体系结构

 二、OSI参考模型

![image-20220204202011278](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220204202011278.png)

三、TCP/IP参考模型

![image-20220204202206185](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220204202206185.png)

  四、五层参考模型

![image-20220204202537467](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220204202537467.png)

  

##  第二章       网络应用

### 第一节   计算机网络==应用==体系结构

三种类型：

1. 客户/服务器（C/S）结构 

   最主要的特征是通信只在客户与服务器之间进行，客户与客户之间不进行直接通信。

2. P2P（Peer to Peer）结构

   每个对等端都同时具备C/S应用的客户与服务器的特征，是一个服务器与客户的结合体，对等端之间直接通信。

3. 混合结构

   既有中心服务器存在，又有对等端（客户）间的直接通信。

### 第二节     网络应用通信基本原理

C/S通信基本原理：服务器端运行的是服务器进程，被动地等待客户请求服务；客户端运行的是客户进程，主动发起通信，请求服务器进程提供服务。应用进程间遵循应用层==协议==交换应用层报文。

![image-20220205160217170](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220205160217170.png)

###  第三节  域名系统（DNS）

域名：一种采用特定的字符、符号，以特定的结构来表示计算机名称的命名方法。

一、层次化域名空间

层次树状结构的命名方法：1.国家顶级域名nTLD;2.通用顶级域名gTLD；3.基础结构域名    便于转换成IP地址  便于查找  分布式管理

![image-20220205162251910](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220205162251910.png)

二、域名服务器

1.域名解析

将域名映射为IP地址的过程

2.域名服务器

为了实现域名解析，需要建立分布式数据库，存储网络中域名与IP地址的映射关系数据，这些数据库存储在域名服务器上，域名服务器根据用户的请求提供域名解析服务。

3.域名服务器分类

- 根域名服务器
- 顶级域名服务器
- 权威域名服务器
- 本地域名服务器

三、域名解析过程

1. 递归查询

   代替查询主机或其他域名服务器，进行进一步的域名查询，并将最终解析结果发送给查询主机或服务器。

   ![image-20220205185703051](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220205185703051.png)

2. 迭代查询

   只是将下一步要查询的服务器告知查询主机或服务器。

   ![image-20220205185919841](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220205185919841.png)

### 第四节     万维网的应用

一、万维网应用结构

Web服务器

浏览器

超文本传输协议（HTTP）（用来传输HTML）

![image-20220206142716320](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220206142716320.png)

二、HTTP

概念：超文本传输协议，定义浏览器如何向Web服务器发送请求以及Web服务器如何向浏览器进行响应。命令响应的格式，报文的格式 数据传输的方式

版本：HTTP/1.0和HTTP/1.1

HTTP连接：非持久连接，持久连接

![image-20220206143659391](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220206143659391.png)

![image-20220206144054290](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220206144054290.png)

HTTP报文：

请求报文---从客户向服务器发送请求报文

响应报文---从服务器到客户的回答

方法：发给服务器的命令

![image-20220206144738266](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220206144738266.png)

HTTP请求报文：   都是ASC码

HTTP典型的请求方法有GET、HEAD、POST、OPTION、PUT等。

1. GET：请求读取由URL所标识的信息。给我提供哪个URL的资源
2. HEAD：请求读取所表示的信息的首部，无需在响应报文中包含对象。HTML的头部，搜索时候 抓取网页的主要信息
3. POST：给服务器添加信息（例如，注释）。
4. OPTION：请求一些选项的信息。
5. PUT：在指明的URL下存储一个文档。

![image-20220206150040109](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220206150040109.png)

![image-20220206150058130](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220206150058130.png)

三、Cookie

Cookie中文名称为小型文本文件，指某些网站为了辨别用户身份、进行会话跟踪而存储在用户本地终端上的数据。

弥补了HTTP协议无状态性的不足，有利于进行用户跟踪并提供针对性的服务，但也带来一些安全问题。

![image-20220206153131164](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220206153131164.png)

###                    第五节    Internet电子邮件

   一、电子邮件系统结构

​		电子邮件系统主要包括邮件服务器、简单邮件传输协议（SMTP）、用户代理（收发的软件）和邮件读取协议等。

![image-20220207144347367](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220207144347367.png)

 二、SMTP

SMTP是Internet电子邮件中核心应用层协议，实现邮件服务器之间或用户代理到邮件服务器之间的邮件传输。SMTP使用传输层TCP实现可靠数据传输，端口号25。SMTP通过三个阶段的应用层交互完成邮件的传输，分别是握手阶段、邮件传输阶段和关闭阶段。
SMTP的基本交互方式是SMTP客户端发送命令，命令后面可能携带参数，SMTP服务器对命令进行应答。

![image-20220207145615486](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220207145615486.png)

三、电子邮件格式与MIME

1.电子邮件包括首部、空白行、主体3部分

To,Subject,Cc,From,Date,Reply-To等关键词。

2.MIME（多用途互联网邮件扩展）支持中文、多媒体传输（技术批量生产短视频）

将非7位ASCII码文本内容转换为7位ASCII码文本内容，然后再利用SMTP进行传输。
在邮件首部增加MIME首部行，说明主体内容原本的数据类型以及采用的编码标准等。

![image-20220207150809538](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220207150809538.png)

四、邮件读取协议

1. 第三版的邮局协议    发指令给服务器  我要读取哪封  传输   下载  在本地
2. 互联网邮件访问协议   直接通过指令操作邮箱改变了邮件服务器上的内容
3. HTTP   只用浏览器就行   

### 第六节                   FTP

文件传送协议（FTP）：在互联网的两个主机间实现文件互传的应用层协议。

C/S模式，采用控制连接（21端口）传输控制命令，数据连接（20端口）传输文件内容。文件可能会比较大  所以两个连接

![image-20220207151642958](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220207151642958.png)

### 第七节   P2P应用

P2P应用的优势：充分聚集利用了端系统（对等方主机）的计算能力以及网络传输带宽，对服务器的依赖很小。

![image-20220207154125269](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220207154125269.png)

### 第八节      Socket编程基础

编应用层  利用下面的层

Socket接口模型：

网络应用进程通信时需要通过API接口请求底层协议的服务。可以创建数据报类型套接字SOCK_DGRAM、流式套接字SOCK_STREAM和原始套接字SOCK_RAW。

![image-20220207154540557](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220207154540557.png)

![image-20220207155102749](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220207155102749.png)

![image-20220207155350607](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220207155350607.png)

### 本章重难点回顾

1. 客户/服务器、P2P两种网络应用体系结构及各自的特点；
2. DNS的概念和工作原理；
3. 万维网应用结构和HTTP协议；
4. 电子邮件系统结构和协议

## 第三章                传输层

为传输层提供服务

### 第一节                 传输层的基本服务

一、传输层功能

一个办公室专门负责收发信件的部门，传达室

传输层的核心任务是为应用进程之间提供端到端（应用到应用）的逻辑通信服务。网络层是从主机到主机    从一个单位送到另一个单位

主要功能：

- 传输层寻址；具体交给某个人
- 应用层报文的分段和重组；
- 报文的差错检测；
- 进程间的端到端可靠数据传输控制；确认收到
- 面向应用层实现复用和分解；很多人寄件  分拣  配送
- 端到端的流量控制 ；控制发的量
- 拥塞控制；

 传输层协议提供逻辑通信服务

传输层协议只需在端系统中实现

通信的真正端点并不是主机，二是主机中运行的应用进程

![image-20220208090222020](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220208090222020.png)

二、传输层寻址与端口

1. .用统一的寻址方式对应用进程进行标识---端口号  www 80 交给web服务器
2. 在全网范围内利用“IP地址＋端口号”唯一标识一个通信端点。
3. 传输层端口号为16位整数，包含三类端口：
   - 熟知端口号，数值为0~1023.
   - 登记端口号，数值为1024~49151，为没有熟知端口号的应用程序使用的。使用这个范围的端口号必须在IANA登记以防止重复。
   - 客户端口号或短暂端口号，数值为49512~65535，留给客户进程选择暂时使用。

![image-20220208091613126](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220208091613126.png)

三、无连接服务与面向连接服务

1. 无连接服务----数据传输之间无需对端进行任何信息交换（即“握手”），直接构造传输层报文段并向接收端发送。----UDP   都不知道收信人存不存在  也不知道有没有空
2. 面向连接服务-----在数据传输前，需要双方交换一些控制信息，建立逻辑连接，然后再传输数据，数据传输结束后还需要再拆除链接。-----TCP

### 第二节    传输层的复用和分解

 多路复用与多路分解：是传输层的一项基本功能，支持众多应用进程共用同一个传输层协议，并能够将接受到的数据准确交付给不同的应用进程。

![image-20220208093434195](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220208093434195.png)

一、无连接的多路复用与多路分解

 UDP套接字：<目的IP地址，目的端口号>

UDP套接字的端口号是UDP实现复用与分解的重要依据。

![image-20220208094013587](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220208094013587.png)

二、面向连接的多路复用与多路分解

TCP套接字（标识一条TCP连接）：

<源IP地址，源端口号，目的IP地址，目的端口号>   两点确定一个直线 建立连接了

当一个TCP报文段从网络层到达一台主机时，该主机根据这4个值来将报文段分解到相应的套接字。

[文本编码 - jonnyleung - 博客园 (cnblogs.com)](https://www.cnblogs.com/jonnyleung/p/11579977.html)

### 第三节        停-等协议与滑动窗口协议

 如何保证通信的可靠性

一、实现可靠传输的措施

1. 差错检测：利用差错编码实现数据包传输过程中的比特差错检测。
2. 确认：接受方向发送方反馈接受状态
3. 重传：发送方重新 发送接受方没有正确接收的数据
4. 序号：确保数据按序提交
5. 计时器：解决数据丢失问题

二、停-等协议

停-等协议的主要特点就是发送一个报文段后就停下来等待接受方的确认。

停-等协议的基本工作过程是：

1. 发送方发送经过差错编码和编号的报文段，等待接收方的 确认；（发送并等待确认）
2. 接受方如果正确接收报文段，即差错检测无误且序号正确则接收报文段，并向发送方发送ACK，否则丢弃报文段，并向发送方发送NAK；（接收并确认/否认）
3. 发送方如果收到ACK，则继续发送后续报文段，否则重发刚刚发送的报文段。（继续发送/重发）

三、滑动窗口协议

1. 停-等协议的主要性能问题：                                                                                    

   停止-等待机制降低了信道利用率

2. 解决方法：

   流水线协议或管道协议——允许发送方在没有收到确认前连续发送多个分组

3. 流水线协议的改进：

   增加分组序号范围；

   发送方和（或）接受方必须缓存多个分组

4. 典型的流水线协议：

   滑动窗口协议

![image-20220209151733074](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220209151733074.png)

两种最具有代表性的滑动窗口协议：

1. 回退N步（Go-Back-N,GBN）协议：

   发送端窗口大小较大，可以在未得到确认前连续发送多个分组；

   但接受窗口大小仅为1，只能接收1个按序到达的分组，未按序到达的分组或者某个分组差错，就会引起发送方重发该分组及其之后的所有分组。

2. 选择重传（Selective Repeat,SR）协议：

   增加接受方缓存能力（接收窗口>1），缓存正确到达但失序的分组，进要求发送方重传未被接受方确认的分组，等缺失分组到达后一并向上层按序提交。

### 第四节    用户数据报协议（UDP）

用户数据报协议UDP是Internet传输层协议，提供无连接、不可靠、数据报尽力传输服务。

一、UDP数据报结构

1. 源和目的端口号：用于UDP实现复用和分解
2. 长度字段：在UDP报文段中的字节数（首部和数据的总和）
3. 校验和：接收方用来检测该报文段是否出现了差错。

计算校验和：

1. 对所有参与运算的内容（包括UDP报文段）按16位（16位对齐）求和；
2. 求和过程中遇到的任何溢出（即进位）都被回卷（即进位与和的最低位再加）；
3. 最后得到的和取反码

### 第五节  传输控制协议（TCP）

一、TCP报文段结构

![image-20220210085011583](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220210085011583.png)

二、TCP连接管理

连接建立----三次握手

1. SYN连接请求
2. SYNACK确认
3. ACK确认

TCP三次握手建立连接过程

![image-20220210085920039](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220210085920039.png)

![image-20220210090444290](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220210090444290.png)

1、TCP的可靠数据传输实现机制包括差错编码、确认、序号、重传、计时器等。

2、TCP的可靠数据传输是基于滑动窗口协议，但是发送窗口大小动态变化。

1. 封装TCP报文段
2. 发出一个报文段后启动一个计时器
3. 通过校验和发现数据差错
4. 通过序号重新排序，丢弃重复的报文段
5. 流量控制

四、TCP流量控制

1、TCP协议利用窗口机制实现流量控制，但不是简单的滑动窗口协议。

2、TCP连接建立时，双方都为之分配了固定大小的缓冲空间；TCP的接收端只允许另一端发送其缓冲区所能接纳的数据。

-  接收端在给发送端发送确认段时，通告接收窗口大小；
- 发送端在接下来发送数据段时，确保未确认段的应用层数据总量不超过接收端通告的接收窗口大小，从而确保接收端不会发生缓存溢出。

五、TCP拥塞控制

1、窗口机制：

通过调节窗口大小实现对发送数据速率的调整。

2、窗口调整的基本策略：

AIMD（Additive Increase,Multiplicative Decrease）

加性增加，乘性减小；

网络未发生拥塞时，逐渐“加性”增加窗口大小，当网络拥塞时“乘性”快速减小窗口大小。

3、TCP的拥塞控制算法

包括了慢启动、拥塞避免、快速重传和快速恢复4部分。

### 本章重难点回顾：

1. 可靠数据传输原理，停-等协议、滑动窗口协议；
2. TCP连接建立和释放过程。
3. TCP可靠数据传输机制和拥塞控制方法。

## 第四章     网络层

### 第一节           网络层服务

网络层的主要作用是将网络层数据报从源主机送达目的主机。

主要功能包括：

1. 转发：分组从输入接口转移到输出接口   有很多路口
2. 路由选择:决定分组经过的路由或路径。

![image-20220212105724119](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220212105724119.png)

### 第二节    数据报网络与虚电路网络

数据报网络：按照目的主机地址进行路由选择的网络。

不可靠

特点：

1. 无连接
2. 每个分组作为一个独立的数据报进行传送，路径也可能不同
3. 分组可能出现乱序和丢失

虚电路网络在网络层提供面向连接的分组交换服务。

特点：

1. 建立一条网络层逻辑连接
2. 不需要为每条虚电路分配独享资源（区别于电路交换）；
3. 根据虚电路号沿虚电路路径按序发送分组

### 第三节   网络互连与网络互连设备

一、异构网络互联

异构网络：两个网络的通信技术和运行的协议不同

异构网络互连的基本策略

1. 协议转换
2. 构建虚拟互联网络

![image-20220212111114117](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220212111114117.png)

二、路由器

![image-20220212111324878](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220212111324878.png)

![image-20220212111613628](C:\Users\HUAWEI\AppData\Roaming\Typora\typora-user-images\image-20220212111613628.png)

### 第四节    网络层拥塞控制

一、网络拥塞

拥塞：一种持续过载的网络状态，此时用户对网络资源（包括链路带宽、存储空间和处理器处理能力等）的总需求超过了网络固有的容量。

原因：

1. 缓冲区容量有限
2. 传输线路的带宽有限
3. 网络结点的处理能力有限
4. 网络中某些部分发生了故障

二、流量感知路由

流量感知路由：

根据网络负载动态调整，将网络流量引导到不同的链路上，均衡网络负载，从而延缓或避免拥塞发生。

解决网络负载的震荡现象：

1. 多路径路由
2. 缓慢转移流量至另一链路

三、准入控制

是一种广泛应用于虚电路网络的拥塞预防技术。

基本思想：

对新建虚电路进行审核，如果新建立的虚电路会导致网络变得拥塞，那么网络拒绝建立该新虚电路。

拥塞状况的量化：基于平均流量和瞬时流量。

四、流量调节

1、感知拥塞

2、处理拥塞：将拥塞信息通知到其上游结点

处理方法：

1. 抑制分组：给用色数据报的源主机返回一个抑制分组
2. 背压：让抑制分组在从拥塞结点到源节点的路径上的每一跳（每一个结点），都发挥抑制作用。

五、负载脱落

负载脱落：路由器主动丢弃某些数据报

如何选择要丢弃的数据报：

1. 丢弃新分组：如GBN   停等协议
2. 丢弃老分组：如实时视频流

